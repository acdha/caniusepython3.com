# This file was generated by Ansible for {{ ansible_fqdn }}
# Do NOT modify this file by hand!

upstream uwsgi-{{wsgi_nginx_servernames.split(' ')[0]}} {
  {% if wsgi_uwsgi_socket.startswith('/') %}
  server unix://{{wsgi_uwsgi_socket}};
  {% elif wsgi_uwsgi_socket.startswith(':') %}
  server localhost{{wsgi_uwsgi_socket}};
  {% else %}
  server {{wsgi_uwsgi_socket}};
  {% endif %}
}

{% if wsgi_nginx_redirect_www %}
server {
    listen     {{wsgi_nginx_port}};
    server_name{% for sn in wsgi_nginx_servernames.split(' ' ) %} www.{{sn}}{% endfor %};
    rewrite ^(.*) http://{{wsgi_nginx_servernames.split(' ')[0]}}$1 permanent;
}
{% endif %}

server {

    listen     {{wsgi_nginx_port}};
    server_name {{wsgi_nginx_servernames}};

    access_log {{wsgi_log_dir}}/nginx.log;
    error_log {{wsgi_log_dir}}/nginx-errors.log;

    charset utf-8;
    client_max_body_size 15M;
    expires off;
    gzip on;

{% for location in wsgi_nginx_static_locations %}
    location {{location}} {
        access_log off;
        root {{wsgi_src_dir}};
        expires max;
    }
{% endfor %}
{% for option in wsgi_nginx_options %}
    {{option}}
{% endfor %}

    location / {
        expires off;
        include uwsgi_params;
        uwsgi_pass uwsgi-{{wsgi_nginx_servernames.split(' ')[0]}};
        proxy_set_header  X-Real-IP  $remote_addr;
        proxy_set_header Host $http_host;
    }

}
